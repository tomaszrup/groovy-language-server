{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Groovy",
  "scopeName": "source.groovy",
  "patterns": [
    { "include": "#hashbang" },
    { "include": "#comments" },
    { "include": "#annotations" },
    { "include": "#strings" },
    { "include": "#regexp" },
    { "include": "#keywords" },
    { "include": "#constants" },
    { "include": "#numbers" },
    { "include": "#types" },
    { "include": "#class-declaration" },
    { "include": "#storage" },
    { "include": "#method-declaration" },
    { "include": "#closure-params" },
    { "include": "#constructor-type" },
    { "include": "#type-reference" },
    { "include": "#method-call" },
    { "include": "#operators" },
    { "include": "#braces" }
  ],
  "repository": {
    "hashbang": {
      "name": "comment.line.hashbang.groovy",
      "match": "\\A(#!).*$\\n?",
      "captures": {
        "1": { "name": "punctuation.definition.comment.groovy" }
      }
    },
    "comments": {
      "patterns": [
        {
          "name": "comment.block.documentation.groovy",
          "begin": "/\\*\\*",
          "end": "\\*/",
          "beginCaptures": { "0": { "name": "punctuation.definition.comment.begin.groovy" } },
          "endCaptures": { "0": { "name": "punctuation.definition.comment.end.groovy" } },
          "patterns": [
            {
              "name": "keyword.other.documentation.groovydoc.groovy",
              "match": "@(?:param|return|returns|throws|see|since|author|version|deprecated|link|code|literal|inheritDoc|serial|serialData|serialField)\\b"
            },
            {
              "name": "variable.parameter.groovydoc.groovy",
              "match": "(?<=@param\\s)[A-Za-z_]\\w*"
            }
          ]
        },
        {
          "name": "comment.block.groovy",
          "begin": "/\\*",
          "end": "\\*/",
          "beginCaptures": { "0": { "name": "punctuation.definition.comment.begin.groovy" } },
          "endCaptures": { "0": { "name": "punctuation.definition.comment.end.groovy" } }
        },
        {
          "name": "comment.line.double-slash.groovy",
          "match": "(//).*$\\n?",
          "captures": {
            "1": { "name": "punctuation.definition.comment.groovy" }
          }
        }
      ]
    },
    "annotations": {
      "patterns": [
        {
          "name": "storage.type.annotation.groovy",
          "match": "(@)\\s*[A-Za-z_][A-Za-z0-9_.]*",
          "captures": {
            "1": { "name": "punctuation.definition.annotation.groovy" }
          }
        }
      ]
    },
    "strings": {
      "patterns": [
        { "include": "#triple-double-quoted-string" },
        { "include": "#triple-single-quoted-string" },
        { "include": "#dollar-slashy-string" },
        { "include": "#double-quoted-string" },
        { "include": "#single-quoted-string" }
      ]
    },
    "triple-double-quoted-string": {
      "name": "string.quoted.triple.double.groovy",
      "begin": "\"\"\"",
      "end": "\"\"\"",
      "beginCaptures": { "0": { "name": "punctuation.definition.string.begin.groovy" } },
      "endCaptures": { "0": { "name": "punctuation.definition.string.end.groovy" } },
      "patterns": [
        { "include": "#string-escape" },
        { "include": "#gstring-interpolation" }
      ]
    },
    "triple-single-quoted-string": {
      "name": "string.quoted.triple.single.groovy",
      "begin": "'''",
      "end": "'''",
      "beginCaptures": { "0": { "name": "punctuation.definition.string.begin.groovy" } },
      "endCaptures": { "0": { "name": "punctuation.definition.string.end.groovy" } },
      "patterns": [
        { "include": "#string-escape" }
      ]
    },
    "double-quoted-string": {
      "name": "string.quoted.double.groovy",
      "begin": "\"",
      "end": "\"",
      "beginCaptures": { "0": { "name": "punctuation.definition.string.begin.groovy" } },
      "endCaptures": { "0": { "name": "punctuation.definition.string.end.groovy" } },
      "patterns": [
        { "include": "#string-escape" },
        { "include": "#gstring-interpolation" }
      ]
    },
    "single-quoted-string": {
      "name": "string.quoted.single.groovy",
      "begin": "'",
      "end": "'",
      "beginCaptures": { "0": { "name": "punctuation.definition.string.begin.groovy" } },
      "endCaptures": { "0": { "name": "punctuation.definition.string.end.groovy" } },
      "patterns": [
        { "include": "#string-escape" }
      ]
    },
    "dollar-slashy-string": {
      "name": "string.quoted.other.dollar-slashy.groovy",
      "begin": "\\$/",
      "end": "/\\$",
      "beginCaptures": { "0": { "name": "punctuation.definition.string.begin.groovy" } },
      "endCaptures": { "0": { "name": "punctuation.definition.string.end.groovy" } },
      "patterns": [
        {
          "name": "constant.character.escape.groovy",
          "match": "\\$\\$|\\$/"
        },
        { "include": "#gstring-interpolation" }
      ]
    },
    "string-escape": {
      "name": "constant.character.escape.groovy",
      "match": "\\\\(?:[btnfr\"'\\\\$]|u[0-9A-Fa-f]{4}|[0-3]?[0-7]{1,2})"
    },
    "gstring-interpolation": {
      "patterns": [
        {
          "name": "meta.interpolation.groovy",
          "begin": "\\$\\{",
          "end": "\\}",
          "beginCaptures": { "0": { "name": "punctuation.section.embedded.begin.groovy" } },
          "endCaptures": { "0": { "name": "punctuation.section.embedded.end.groovy" } },
          "contentName": "source.groovy.embedded",
          "patterns": [
            { "include": "source.groovy" }
          ]
        },
        {
          "name": "variable.other.interpolated.groovy",
          "match": "(\\$)[A-Za-z_]\\w*(?:\\.[A-Za-z_]\\w*)*",
          "captures": {
            "1": { "name": "punctuation.section.embedded.groovy" }
          }
        }
      ]
    },
    "regexp": {
      "patterns": [
        {
          "comment": "Tilde-prefixed slashy regex: ~/pattern/ — unambiguous",
          "name": "string.regexp.groovy",
          "begin": "~/(?![/*+{}?])",
          "end": "/([gimsxUd]*)",
          "beginCaptures": { "0": { "name": "punctuation.definition.string.begin.groovy" } },
          "endCaptures": {
            "0": { "name": "punctuation.definition.string.end.groovy" },
            "1": { "name": "keyword.other.regexp.flags.groovy" }
          },
          "patterns": [
            {
              "name": "constant.character.escape.groovy",
              "match": "\\\\/"
            },
            { "include": "#gstring-interpolation" }
          ]
        },
        {
          "comment": "Bare slashy regex: /pattern/ — lookbehind rejects division (after \\w, ), ])",
          "name": "string.regexp.groovy",
          "begin": "(?<![\\w)\\]])/(?![/*+{}?\\s])",
          "end": "/([gimsxUd]*)",
          "beginCaptures": { "0": { "name": "punctuation.definition.string.begin.groovy" } },
          "endCaptures": {
            "0": { "name": "punctuation.definition.string.end.groovy" },
            "1": { "name": "keyword.other.regexp.flags.groovy" }
          },
          "patterns": [
            {
              "name": "constant.character.escape.groovy",
              "match": "\\\\/"
            },
            { "include": "#gstring-interpolation" }
          ]
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.groovy",
          "match": "\\b(if|else|for|while|do|switch|case|default|break|continue|return|assert|in|yield)\\b"
        },
        {
          "name": "keyword.control.exception.groovy",
          "match": "\\b(try|catch|finally|throw|throws)\\b"
        },
        {
          "name": "keyword.operator.groovy",
          "match": "\\b(as|in|instanceof|new)\\b"
        },
        {
          "comment": "import statement with class name highlighting",
          "match": "\\b(import)\\s+(static\\s+)?([A-Za-z_][\\w.]*\\.)?([A-Z]\\w*|\\*)",
          "captures": {
            "1": { "name": "keyword.other.import.groovy" },
            "2": { "name": "storage.modifier.groovy" },
            "4": { "name": "entity.name.type.class.groovy" }
          }
        },
        {
          "comment": "package statement with namespace highlighting",
          "match": "\\b(package)\\s+([A-Za-z_]\\w*(?:\\.[A-Za-z_]\\w*)*)",
          "captures": {
            "1": { "name": "keyword.other.package.groovy" },
            "2": { "name": "entity.name.type.module.groovy" }
          }
        },
        {
          "name": "keyword.other.groovy",
          "match": "\\b(def|var|it|this|super|with)\\b"
        },
        {
          "name": "storage.type.groovy",
          "match": "\\b(implements|extends)\\b"
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.language.groovy",
          "match": "\\b(true|false|null)\\b"
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.hex.groovy",
          "match": "\\b0[xX][0-9A-Fa-f]([0-9A-Fa-f_]*[0-9A-Fa-f])?[lLgGiI]?\\b"
        },
        {
          "name": "constant.numeric.octal.groovy",
          "match": "\\b0[0-7]([0-7_]*[0-7])?[lLgGiI]?\\b"
        },
        {
          "name": "constant.numeric.binary.groovy",
          "match": "\\b0[bB][01]([01_]*[01])?[lLgGiI]?\\b"
        },
        {
          "name": "constant.numeric.decimal.groovy",
          "match": "\\b[0-9]([0-9_]*[0-9])?(\\.[0-9]([0-9_]*[0-9])?)?([eE][+-]?[0-9]([0-9_]*[0-9])?)?[fFdDgGiI]?\\b"
        }
      ]
    },
    "types": {
      "patterns": [
        {
          "name": "storage.type.primitive.groovy",
          "match": "\\b(boolean|byte|char|double|float|int|long|short|void)\\b"
        }
      ]
    },
    "storage": {
      "patterns": [
        {
          "name": "storage.modifier.groovy",
          "match": "\\b(public|protected|private|static|final|abstract|native|synchronized|transient|volatile|strictfp|sealed|non-sealed|permits)\\b"
        },
        {
          "name": "storage.type.groovy",
          "match": "\\b(class|interface|enum|trait|record)\\b"
        }
      ]
    },
    "class-declaration": {
      "match": "\\b(class|interface|enum|trait|record)\\s+([A-Za-z_]\\w*)",
      "captures": {
        "1": { "name": "storage.type.groovy" },
        "2": { "name": "entity.name.type.class.groovy" }
      }
    },
    "method-declaration": {
      "patterns": [
        {
          "comment": "Method with uppercase return type: String getName()",
          "match": "\\b([A-Z]\\w*(?:<[^>]+>)?(?:\\[\\])*)\\s+([A-Za-z_]\\w*)\\s*(?=\\()",
          "captures": {
            "1": { "name": "support.type.groovy" },
            "2": { "name": "entity.name.function.groovy" }
          }
        },
        {
          "comment": "Method with def/void or lowercase return type",
          "match": "(?:[a-z_]\\w*(?:<[^>]+>)?(?:\\[\\])*\\s+|\\b(?:def|void)\\s+)([A-Za-z_]\\w*)\\s*(?=\\()",
          "captures": {
            "1": { "name": "entity.name.function.groovy" }
          }
        }
      ]
    },
    "closure-params": {
      "match": "([A-Za-z_]\\w*(?:\\s*,\\s*[A-Za-z_]\\w*)*)\\s*(->)",
      "captures": {
        "1": { "name": "variable.parameter.closure.groovy" },
        "2": { "name": "storage.type.function.arrow.groovy" }
      }
    },
    "constructor-type": {
      "comment": "Type name after 'new' keyword: new MyClass() or new ArrayList<String>()",
      "match": "\\b(new)\\s+([A-Z]\\w*)",
      "captures": {
        "1": { "name": "keyword.operator.groovy" },
        "2": { "name": "entity.name.type.class.groovy" }
      }
    },
    "type-reference": {
      "comment": "Uppercase type before a variable name: String name, MyClass obj, List<T> items",
      "match": "\\b([A-Z]\\w*(?:<[^>]+>)?(?:\\[\\])*)\\s+(?=[a-z_]\\w*\\s*[=,;){}\\n])",
      "captures": {
        "1": { "name": "support.type.groovy" }
      }
    },
    "method-call": {
      "match": "([A-Za-z_]\\w*)\\s*(?=\\()",
      "captures": {
        "1": { "name": "entity.name.function.groovy" }
      }
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.comparison.groovy",
          "match": "<=>|==~|===|!==|==|!=|<=|>=|<|>"
        },
        {
          "name": "keyword.operator.assignment.groovy",
          "match": "\\+=|-=|\\*=|/=|%=|&=|\\|=|\\^=|<<=|>>=|>>>=|\\*\\*=|\\?=|(?<![=!<>])=(?!=)"
        },
        {
          "name": "keyword.operator.logical.groovy",
          "match": "&&|\\|\\||!"
        },
        {
          "name": "keyword.operator.bitwise.groovy",
          "match": "~|&|\\||\\^|>>>|>>|<<"
        },
        {
          "name": "keyword.operator.arithmetic.groovy",
          "match": "\\*\\*|\\+\\+|--|\\+|-|\\*|/|%"
        },
        {
          "name": "keyword.operator.safe-navigation.groovy",
          "match": "\\?\\.|\\?\\.@|\\?:|\\*\\.|\\.\\.<?|->|::"
        },
        {
          "name": "keyword.operator.spread.groovy",
          "match": "\\*:"
        },
        {
          "name": "keyword.operator.range.groovy",
          "match": "\\.\\.<|\\.\\."
        },
        {
          "name": "keyword.operator.ternary.groovy",
          "match": "\\?|:"
        }
      ]
    },
    "braces": {
      "patterns": [
        {
          "name": "punctuation.section.block.begin.groovy",
          "match": "\\{"
        },
        {
          "name": "punctuation.section.block.end.groovy",
          "match": "\\}"
        },
        {
          "name": "punctuation.bracket.round.groovy",
          "match": "[()]"
        },
        {
          "name": "punctuation.bracket.square.groovy",
          "match": "[\\[\\]]"
        },
        {
          "name": "punctuation.separator.groovy",
          "match": "[;,]"
        }
      ]
    }
  }
}
